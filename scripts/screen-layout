#!/usr/bin/env bash

# CONFIGURATION
LAYOUT_DIR="$HOME/.screenlayout"
ROFI_THEME="$HOME/.config/rofi/screen-layout.rasi"
WALLPAPER_CMD="feh --randomize --bg-fill $HOME/Pictures/wallpapers/*.png"

# Arrays
declare -a file_list
declare -a display_list

# Check directory
if [ ! -d "$LAYOUT_DIR" ]; then
    notify-send "Error" "Layout directory $LAYOUT_DIR not found!" -u critical
    exit 1
fi

# SCAN LOOP
while IFS= read -r file; do
    [ -e "$file" ] || continue
    filename=$(basename "$file" .sh)
    
    # Icon Logic
    case "$filename" in
        *"up"*)     icon="⬆" ;;
        *"down"*)   icon="⬇" ;;
        *"left"*)   icon="⬅" ;;
        *"right"*)  icon="➡" ;;
        *"mirror"*) icon="" ;;
        *"single"*) icon="" ;;
        *)          icon="" ;;
    esac

    # Name Formatting (Title Case, no hyphens)
    clean_name="${filename//[-_]/ }"
    clean_name=${clean_name^}

    # Display String (Icon + Name Only)
    display_str="$icon  $clean_name"

    file_list+=("$file")
    display_list+=("$display_str")

done < <(find "$LAYOUT_DIR" -maxdepth 1 -name "*.sh" | sort)

# ROFI EXECUTION
# -format i returns the index (0, 1, 2...) of the selection
selected_index=$(printf "%s\n" "${display_list[@]}" | rofi -dmenu -i -theme "$ROFI_THEME" -format i)

# APPLY SELECTION
if [ -n "$selected_index" ]; then
    target_script="${file_list[$selected_index]}"
    
    if [ -x "$target_script" ]; then
        "$target_script"
        eval "$WALLPAPER_CMD"
        i3-msg restart
        notify-send "Display Layout" "Applied: $(basename "$target_script" .sh)" -i video-display
    fi
fi
